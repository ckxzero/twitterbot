var Twit = require('twit')

// these are my info
// currently set to read only
var T = new Twit({
    consumer_key: 'ORw7R2be9bKvzErqt0nL3JFhm',
    consumer_secret: 'ZOT443qP4GMFgz41FhSNBeRPKiND1ecA9ZQiIpM89ciD5nkYE3',
    access_token: '1220121834-3RhaQ7SDYWivB9DzvH8OskytUsxC0ZEJ17xw1AV',
    access_token_secret: '50M0VaoPEHp2PQO4AIILE5ajLAFud5JUNbbOil9l2gPlo'
});

var tests = {
    q: 'tests',
    since: "2014-12-10",
    count: 100
};

var exams = {
    q: 'exams',
    since: "2014-12-2",
    count: 10
};

var finals = {
    q: 'finals',
    since: "2014-12-11",
    count: 100
};

// searching tweets with the word "finals" in them
T.get('search/tweets', finals, function(err, data, response) {
    var incomingTweets = [];
    for (var i = 0; i < data.statuses.length; ++i){
	incomingTweets[i] = data.statuses[i].text;
	console.log(incomingTweets[i]);
    }
    console.log(incomingTweets.length);
    
    // filter out tweets
    var wantedTweets = filterTweets(incomingTweets);

    // I will only do precision since recall requires rebuilding the database everytime we run
    // our goal is to find tweets that are 1. from uga students. 2 talking/complaining about tests/exams/finals
    // UGA is only a small subset of all possible students from many different universities
    // and this function only pulls 100 tweets at most
    // thus giving us a precision 0 for most runs
    var precision = wantedTweets.length / incomingTweets.length;
    console.log("precision: ", precision);

    // printing out our filtered tweets to see if they are what we want
    wantedTweets.forEach(function(element) {
	console.log(element);
    });
});

function filterTweets(incomingTweets) {
    var keywords = ["uga", 
		    "university of georgia", 
		    "bulldawg nation", 
		    "dawgs", 
		    "ugga"];

    var wantedTweets = [];
    for (var i = 0; i < incomingTweets.length; ++i) {
	// split each tweet into individual words
	var words = incomingTweets[i].split(" ");
	
	// determine if each tweet includes a word that tells us it is from uga
	for (var j = 0; j < words.length; ++j) {
	    for (var k = 0; k < keywords.length; ++k) {
		if (words[j].toLowerCase() == keywords[k]) {
		    console.log("in here!");
		    wantedTweets.push(incomingTweets[i]);
		    break;
		}
	    }
	}
    }

    return wantedTweets;
}


